<ng-container *ngIf="!!reviews && !!meta">
  <strong *ngIf="displayLabel">댓글</strong>&nbsp;
  <span class="desc" *ngIf="displayLabel && !!reviews">{{meta.totalItemsWithChildren}}개</span>
  <div *ngFor="let review of reviews | paginate: {
      id:meta.paginationId,
      itemsPerPage: meta.itemsPerPage, 
      currentPage: meta.currentPage,
      totalItems:meta.totalItems
    }; let i = index" class="review-wrapper">
    <!-- parent comments -->
    <ng-container *ngIf="review.comment !== DELETE_FLAG">
      <ion-item lines="none" style="margin-left: -12px;">
        <ion-avatar slot="start" class="avatar">
          <img *ngIf="review.user.profilePhoto" [src]="review.user.profilePhoto" class="avatar" />
          <ion-icon *ngIf="!review.user.profilePhoto" name="person-circle-outline" style="color:#3880ff" class="avatar">
          </ion-icon>
        </ion-avatar>
        <ion-label>
          <h3 style="margin-bottom: -5px;">{{review.user.nickname}}</h3>
          <span class="date">{{review.createdAt|date:'yyyy.MM.dd'}}</span>
          <ion-icon *ngIf="editable && review.canDelete" class="comment-icon" name="trash-outline"
            (click)="deleteComment(review)"></ion-icon>
          <ion-icon *ngIf="editable" class="comment-icon" name="chatbox-ellipses-outline"
            (click)="showChildComment(i, review)">
          </ion-icon>
        </ion-label>
      </ion-item>
      <p class="comment pre-wrap">{{review.comment}}</p>
    </ng-container>
    <ng-container *ngIf="review.comment === DELETE_FLAG">
      <div style="display: flex;  margin-top: 8px;">
        <ion-icon name="person-circle-outline" style="color:#3880ff" class="avatar"></ion-icon>
        <p class="desc" style="margin-top: 8px;">{{review.comment}}</p>
      </div>
    </ng-container>
    <!-- child comments -->
    <ng-container *ngFor="let child of review.children">
      <ion-item lines="none">
        <ion-avatar slot="start" class="avatar">
          <img *ngIf="child.user.profilePhoto" [src]="child.user.profilePhoto" class="avatar" />
          <ion-icon *ngIf="!child.user.profilePhoto" name="person-circle-outline" style="color:#3880ff" class="avatar">
          </ion-icon>
        </ion-avatar>
        <ion-label>
          <h3 style="margin-bottom: -5px;">{{child.user.nickname}}</h3>
          <span class="date">{{child.createdAt|date:'yyyy.MM.dd'}}</span>
          <ion-icon class="comment-icon" *ngIf="editable && child.canDelete" name="trash-outline"
            (click)="deleteComment(child)"></ion-icon>
        </ion-label>
      </ion-item>
      <p class="child-comment pre-wrap">{{child.comment}}</p>
    </ng-container>
    <div #addChildInput style="display: none;">
      <div style="display: flex;">
        <ion-textarea class="comment-textarea" rows="1" maxlength="999" (click)="canWrite? '':needLogin()"
          (input)="onInput($event)" style="margin-left: 17px;" [disabled]="!canWrite"
          [placeholder]="canWrite?'대댓글을 입력해주세요.':'로그인이 필요합니다.'">
        </ion-textarea>
        <ion-icon name="checkmark-outline" slot="end" (click)="okChild(i, review)"
          style="font-size:24px; margin-top: 13px;">
        </ion-icon>
      </div>
    </div>
  </div>
  <ng-container *ngIf="editable">
    <div style="display: flex;">
      <ion-textarea class="comment-textarea" #comment rows="1" maxlength="999" (click)="canWrite? '':needLogin()"
        (input)="onInput($event)" [(ngModel)]="commentInput" style="margin-right: 10px;" [disabled]="!canWrite"
        [placeholder]="canWrite?'댓글을 입력해주세요.':'로그인이 필요합니다.'">
      </ion-textarea>
      <ion-icon name="checkmark-outline" slot="end" (click)="ok()" style="font-size:24px; margin-top: 13px;">
      </ion-icon>
    </div>
  </ng-container>
</ng-container>

<pagination *ngIf="!!meta && reviews.length>0" (onChange)="pageChanged($event)" [paginationId]="meta.paginationId">
</pagination>